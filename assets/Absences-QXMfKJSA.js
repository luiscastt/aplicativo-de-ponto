import{r as x,m as e,a4 as c,a5 as y}from"./vendor-CTLkAQ17.js";import{b as K,u as U,a as M}from"./vendor-supabase-query-BZ8e5l_3.js";import{C as V,a as G,b as X,d as J}from"./card-Cv3fZd4i.js";import{T as W,a as Y,b as _,c as d,d as Z,e as m}from"./table-DuTSpFz9.js";import{u as ee,B as o,c as E,b as q,s as h}from"./index-BTnllf_j.js";import{D as se,f as ae,a as te,b as re,c as ie,d as ne,e as oe}from"./dialog-CSShFCkQ.js";import{S as le,a as ce,b as de,c as me,d as b}from"./select-DRKyGRlm.js";import{I as ue}from"./input-BjE4wIy-.js";import{L as g}from"./label-DoZpU7nD.js";import{P as R,a as I,b as L,C as z}from"./calendar-CAMB6cU1.js";import{s as C,a as B}from"./toast-BTgtjvQY.js";import{P as xe,m as he,j as O,L as k,R as je,n as pe,X as fe}from"./vendor-icons-BvmhBeEN.js";import"./vendor-react-router-xEMQRDFj.js";const ye=async t=>{const{data:{user:r}}=await h.auth.getUser();let a=h.from("absences").select(`
      id, user_id, type, start_date, end_date, reason, status,
      profiles(first_name, email)
    `).order("created_at",{ascending:!1});!t&&r&&(a=a.eq("user_id",r.id));const{data:l,error:u}=await a;if(u)throw u;return l},ge=async(t,r)=>{const{error:a}=await h.from("absences").update({status:r}).eq("id",t);if(a)throw a},ve=async t=>{const{data:{user:r}}=await h.auth.getUser(),a=r==null?void 0:r.id;if(!a)throw new Error("Usuário não autenticado.");const{error:l}=await h.from("absences").insert({...t,user_id:a});if(l)throw l},Ne=t=>{switch(t){case"aprovado":return"default";case"rejeitado":return"destructive";default:return"secondary"}},Re=()=>{const{user:t}=ee(),r=K(),a=(t==null?void 0:t.role)==="gestor"||(t==null?void 0:t.role)==="admin",[l,u]=x.useState(!1),[j,S]=x.useState(void 0),[i,A]=x.useState(void 0),[n,D]=x.useState(void 0),[P,T]=x.useState(""),{data:v,isLoading:N,refetch:H}=U({queryKey:["absences",a],queryFn:()=>ye(a),enabled:!!t}),p=M({mutationFn:({id:s,status:f})=>ge(s,f),onSuccess:()=>{B("Status de ausência atualizado!"),r.invalidateQueries({queryKey:["absences"]})},onError:s=>C(`Erro ao atualizar status: ${s.message}`)}),w=M({mutationFn:ve,onSuccess:()=>{B("Solicitação de ausência enviada com sucesso!"),u(!1),S(void 0),A(void 0),D(void 0),T(""),r.invalidateQueries({queryKey:["absences"]})},onError:s=>C(`Erro ao solicitar ausência: ${s.message}`)}),Q=s=>{if(s.preventDefault(),!i||!n||!j){C("Preencha todos os campos obrigatórios (Tipo, Início e Fim).");return}w.mutate({start_date:c(i,"yyyy-MM-dd"),end_date:c(n,"yyyy-MM-dd"),type:j,reason:P})},$=()=>N?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):!v||v.length===0?e.jsx("div",{className:"text-left text-muted-foreground py-8",children:"Nenhuma solicitação de ausência encontrada."}):e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(_,{children:[a&&e.jsx(d,{children:"Colaborador"}),e.jsx(d,{children:"Tipo"}),e.jsx(d,{children:"Período"}),e.jsx(d,{className:"hidden md:table-cell",children:"Motivo"}),e.jsx(d,{children:"Status"}),a&&e.jsx(d,{children:"Ações"})]})}),e.jsx(Z,{children:v.map(s=>{var f,F;return e.jsxs(_,{children:[a&&e.jsx(m,{className:"font-medium text-card-foreground",children:((f=s.profiles)==null?void 0:f.first_name)||((F=s.profiles)==null?void 0:F.email)}),e.jsx(m,{children:e.jsx(q,{variant:"secondary",children:s.type})}),e.jsxs(m,{className:"text-card-foreground text-sm",children:[c(new Date(s.start_date),"dd/MM/yyyy")," - ",c(new Date(s.end_date),"dd/MM/yyyy")]}),e.jsx(m,{className:"hidden md:table-cell text-muted-foreground text-sm max-w-xs truncate",children:s.reason||"N/A"}),e.jsx(m,{children:e.jsx(q,{variant:Ne(s.status),children:s.status})}),a&&e.jsx(m,{className:"space-x-2",children:s.status==="pendente"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>p.mutate({id:s.id,status:"aprovado"}),disabled:p.isPending,title:"Aprovar",children:e.jsx(pe,{className:"h-4 w-4 text-green-600"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>p.mutate({id:s.id,status:"rejeitado"}),disabled:p.isPending,title:"Rejeitar",children:e.jsx(fe,{className:"h-4 w-4 text-red-600"})})]})})]},s.id)})})]});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(xe,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Férias e Afastamentos"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a?"Gerencie e aprove solicitações de ausência.":"Solicite e acompanhe suas férias e afastamentos."})]}),e.jsxs("div",{className:"mb-6 flex justify-end",children:[e.jsxs(se,{open:l,onOpenChange:u,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Solicitar Ausência"]})}),e.jsxs(te,{className:"sm:max-w-[425px]",children:[e.jsxs(re,{children:[e.jsx(ie,{className:"text-card-foreground",children:"Nova Solicitação"}),e.jsx(ne,{children:"Preencha o período e o tipo de ausência."})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"type",children:"Tipo de Ausência"}),e.jsxs(le,{name:"type",required:!0,value:j,onValueChange:s=>S(s),children:[e.jsx(ce,{id:"type",children:e.jsx(de,{placeholder:"Selecione o tipo"})}),e.jsxs(me,{children:[e.jsx(b,{value:"ferias",children:"Férias"}),e.jsx(b,{value:"afastamento",children:"Afastamento"}),e.jsx(b,{value:"licenca",children:"Licença"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"start_date",children:"Data Início"}),e.jsxs(R,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:E("w-full justify-start text-left font-normal",!i&&"text-muted-foreground"),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),i?c(i,"PPP",{locale:y}):e.jsx("span",{children:"Selecione"})]})}),e.jsx(L,{className:"w-auto p-0",children:e.jsx(z,{mode:"single",selected:i,onSelect:A,initialFocus:!0,locale:y})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"end_date",children:"Data Fim"}),e.jsxs(R,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:E("w-full justify-start text-left font-normal",!n&&"text-muted-foreground"),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),n?c(n,"PPP",{locale:y}):e.jsx("span",{children:"Selecione"})]})}),e.jsx(L,{className:"w-auto p-0",children:e.jsx(z,{mode:"single",selected:n,onSelect:D,initialFocus:!0,locale:y,disabled:s=>i?s<i:!1})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"reason",children:"Motivo (Opcional)"}),e.jsx(ue,{id:"reason",name:"reason",value:P,onChange:s=>T(s.target.value)})]}),e.jsx(oe,{children:e.jsx(o,{type:"submit",disabled:w.isPending||!i||!n||!j,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Solicitação"})})]})]})]}),e.jsx(o,{variant:"outline",size:"icon",onClick:()=>H(),disabled:N,className:"ml-2",children:e.jsx(je,{className:`h-4 w-4 ${N?"animate-spin":""}`})})]}),e.jsxs(V,{children:[e.jsx(G,{children:e.jsx(X,{className:"text-card-foreground",children:"Minhas Solicitações"})}),e.jsx(J,{children:$()})]})]})};export{Re as default};
