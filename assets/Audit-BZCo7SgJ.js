import{r as N,m as e}from"./vendor-CTLkAQ17.js";import{u as _}from"./vendor-supabase-query-BZ8e5l_3.js";import{C as g,a as L,b as T,d as b}from"./card-Cv3fZd4i.js";import{T as P,a as R,b as v,c,d as B,e as l}from"./table-DuTSpFz9.js";import{u as M,B as f,b as u,s as S}from"./index-BTnllf_j.js";import{b as z,R as D,k,l as E,L as F}from"./vendor-icons-BvmhBeEN.js";import"./vendor-react-router-xEMQRDFj.js";const w=10,H=async(t,a)=>{const{data:m,error:i,count:r}=await S.from("audit_logs").select(`
      *,
      profiles(first_name, email)
    `,{count:"exact"}).order("timestamp",{ascending:!1}).range((t-1)*a,t*a-1);if(i)throw i;return{logs:m||[],total:r||0}},y=t=>{switch(t){case"ponto_registrado":return e.jsx(u,{variant:"default",className:"bg-green-600 hover:bg-green-600/90",children:"Ponto Registrado"});case"face_verification_attempt":return e.jsx(u,{variant:"secondary",children:"Verificação Facial"});case"perfil_atualizado":return e.jsx(u,{variant:"outline",children:"Perfil Atualizado"});default:return e.jsx(u,{variant:"secondary",children:t})}},U=()=>{const{user:t}=M(),[a,m]=N.useState(1),i=(t==null?void 0:t.role)==="gestor"||(t==null?void 0:t.role)==="admin",{data:r,isLoading:n,refetch:C}=_({queryKey:["auditLogs",a],queryFn:()=>H(a,w),enabled:!!t}),h=(r==null?void 0:r.logs)||[],j=(r==null?void 0:r.total)||0,x=N.useMemo(()=>Math.ceil(j/w),[j]),p=s=>s?s.match!==void 0?e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Match: ",s.match?"Sim":"Não"," | Confiança: ",(s.confidence*100).toFixed(0),"%"]}):s.updated_fields?e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Campos atualizados: ",s.updated_fields.join(", ")]}):JSON.stringify(s):"N/A",A=()=>n?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-primary"})}):h.length===0?e.jsx("div",{className:"text-left text-muted-foreground py-8",children:"Nenhum log de auditoria encontrado."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(v,{children:[e.jsx(c,{className:"w-[150px]",children:"Data/Hora"}),i&&e.jsx(c,{children:"Colaborador"}),e.jsx(c,{children:"Ação"}),e.jsx(c,{children:"Detalhes"}),e.jsx(c,{children:"IP"})]})}),e.jsx(B,{children:h.map(s=>{var d,o;return e.jsxs(v,{children:[e.jsx(l,{className:"font-medium text-card-foreground",children:new Date(s.timestamp).toLocaleString("pt-BR")}),i&&e.jsx(l,{className:"text-card-foreground",children:((d=s.profiles)==null?void 0:d.first_name)||((o=s.profiles)==null?void 0:o.email)||s.user_id}),e.jsx(l,{children:y(s.action)}),e.jsx(l,{className:"text-sm text-muted-foreground max-w-xs truncate",children:p(s.details)}),e.jsx(l,{className:"text-xs text-muted-foreground",children:s.ip_address||"N/A"})]},s.id)})})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:h.map(s=>{var d,o;return e.jsx(g,{className:"shadow-sm",children:e.jsxs(b,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold text-base truncate text-card-foreground",children:i?((d=s.profiles)==null?void 0:d.first_name)||((o=s.profiles)==null?void 0:o.email)||"Usuário":"Minha Atividade"}),y(s.action)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.timestamp).toLocaleString("pt-BR")}),e.jsxs("div",{className:"text-xs text-muted-foreground pt-1",children:["Detalhes: ",p(s.details)]})]})},s.id)})})]});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(z,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Auditoria de Registros"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i?"Monitoramento de todas as ações do sistema, incluindo registros de ponto e verificações faciais.":"Seu histórico de atividades e registros de ponto."})]}),e.jsxs(g,{children:[e.jsxs(L,{className:"flex flex-row items-center justify-between",children:[e.jsx(T,{className:"text-xl text-card-foreground",children:"Logs de Atividade"}),e.jsxs(f,{onClick:()=>C(),variant:"outline",size:"sm",disabled:n,children:[e.jsx(D,{className:`mr-2 h-4 w-4 ${n?"animate-spin":""}`}),"Atualizar"]})]}),e.jsxs(b,{children:[A(),x>1&&e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>m(s=>Math.max(s-1,1)),disabled:a===1||n,children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Anterior"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Página ",a," de ",x]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>m(s=>Math.min(s+1,x)),disabled:a===x||n,children:["Próxima",e.jsx(E,{className:"h-4 w-4 ml-2"})]})]})]})]})]})};export{U as default};
