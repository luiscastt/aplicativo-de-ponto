import{r as w,m as e,a4 as E,a5 as S}from"./vendor-CTLkAQ17.js";import{b as F,u as M,a as f}from"./vendor-supabase-query-BZ8e5l_3.js";import{C as p,a as j,b as g,d as v,e as P}from"./card-Cv3fZd4i.js";import{c as _,u as B,B as c,s as m}from"./index-BTnllf_j.js";import{I}from"./input-BjE4wIy-.js";import{L as b}from"./label-DoZpU7nD.js";import{D as L,f as H,a as O,b as Q,c as k,d as z,e as K}from"./dialog-CSShFCkQ.js";import{S as R}from"./scroll-area-2rGlh5Z0.js";import{s as d,a as N}from"./toast-BTgtjvQY.js";import{B as $,m as G,L as y,s as U,T as J}from"./vendor-icons-BvmhBeEN.js";import"./vendor-react-router-xEMQRDFj.js";const C=w.forwardRef(({className:a,...t},r)=>e.jsx("textarea",{className:_("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:r,...t}));C.displayName="Textarea";const V=async()=>{const{data:a,error:t}=await m.from("announcements").select(`
      id, user_id, title, content, created_at,
      profiles(first_name, email)
    `).order("created_at",{ascending:!1}).limit(20);if(t)throw t;return a},W=async(a,t)=>{const{error:r}=await m.from("announcements").insert({title:a,content:t});if(r)throw r},X=async a=>{const{error:t}=await m.from("announcements").delete().eq("id",a);if(t)throw t},de=()=>{const{user:a}=B(),t=F(),r=(a==null?void 0:a.role)==="gestor"||(a==null?void 0:a.role)==="admin",[D,x]=w.useState(!1),{data:o,isLoading:A,refetch:Y}=M({queryKey:["announcements"],queryFn:V,enabled:!!a}),l=f({mutationFn:({title:s,content:i})=>W(s,i),onSuccess:()=>{N("Aviso publicado com sucesso!"),x(!1),t.invalidateQueries({queryKey:["announcements"]})},onError:s=>d(`Erro ao publicar aviso: ${s.message}`)}),u=f({mutationFn:X,onSuccess:()=>{N("Aviso removido."),t.invalidateQueries({queryKey:["announcements"]})},onError:s=>d(`Erro ao remover aviso: ${s.message}`)}),T=s=>{s.preventDefault();const i=s.currentTarget,n=i.elements.namedItem("title").value.trim(),h=i.elements.namedItem("content").value.trim();if(!n||!h){d("Título e conteúdo são obrigatórios.");return}l.mutate({title:n,content:h})},q=s=>{window.confirm("Tem certeza que deseja deletar este aviso?")&&u.mutate(s)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Avisos da Empresa"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Mantenha-se atualizado com as comunicações importantes da gestão."})]}),e.jsx("div",{className:"mb-6 flex justify-end",children:r&&e.jsxs(L,{open:D,onOpenChange:x,children:[e.jsx(H,{asChild:!0,children:e.jsxs(c,{children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Novo Aviso"]})}),e.jsxs(O,{className:"sm:max-w-[425px]",children:[e.jsxs(Q,{children:[e.jsx(k,{className:"text-card-foreground",children:"Publicar Novo Aviso"}),e.jsx(z,{children:"Este aviso será visível para todos os colaboradores."})]}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"title",children:"Título"}),e.jsx(I,{id:"title",name:"title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"content",children:"Conteúdo"}),e.jsx(C,{id:"content",name:"content",required:!0,rows:5})]}),e.jsx(K,{children:e.jsx(c,{type:"submit",disabled:l.isPending,children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Publicando..."]}):"Publicar Aviso"})})]})]})]})}),e.jsxs(p,{children:[e.jsx(j,{children:e.jsx(g,{className:"text-card-foreground",children:"Últimos Avisos"})}),e.jsx(v,{children:A?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx(R,{className:"h-[60vh]",children:e.jsx("div",{className:"space-y-4 pr-4",children:(o==null?void 0:o.length)===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Nenhum aviso publicado ainda."}):o==null?void 0:o.map(s=>{var i,n;return e.jsxs(p,{className:"shadow-sm border-l-4 border-primary",children:[e.jsxs(j,{className:"p-4 pb-2",children:[e.jsx(g,{className:"text-lg text-card-foreground text-left",children:s.title}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:((i=s.profiles)==null?void 0:i.first_name)||((n=s.profiles)==null?void 0:n.email)||"Sistema"})]}),e.jsx("span",{children:E(new Date(s.created_at),"dd 'de' MMMM 'às' HH:mm",{locale:S})})]})]}),e.jsx(v,{className:"p-4 pt-2 text-left text-sm text-card-foreground",children:e.jsx("p",{children:s.content})}),r&&e.jsx(P,{className:"p-4 pt-0 flex justify-end",children:e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>q(s.id),disabled:u.isPending,className:"text-red-500 hover:text-red-700",children:[e.jsx(J,{className:"h-4 w-4 mr-1"})," Deletar"]})})]},s.id)})})})})]})]})};export{de as default};
