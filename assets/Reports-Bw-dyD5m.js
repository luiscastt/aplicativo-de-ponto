import{r as m,m as e,a4 as n,a5 as x}from"./vendor-CTLkAQ17.js";import{C as u,a as h,b as p,d as j}from"./card-Cv3fZd4i.js";import{u as S,B as c,c as f,s as g}from"./index-BTnllf_j.js";import{P as N,a as y,b as w,C as v}from"./calendar-CAMB6cU1.js";import{a as B}from"./vendor-supabase-query-BZ8e5l_3.js";import{d as C,s as b,a as A,b as _}from"./toast-BTgtjvQY.js";import{a as T,F as E,j as D,L as k}from"./vendor-icons-BvmhBeEN.js";import"./vendor-react-router-xEMQRDFj.js";const I=async t=>{const{data:{session:r}}=await g.auth.getSession(),s=r==null?void 0:r.access_token;if(!s)throw new Error("Usuário não autenticado.");const{data:d,error:a}=await g.functions.invoke("export-payroll",{body:t,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(a)throw a;return d},U=()=>{const{user:t}=S(),r=(t==null?void 0:t.role)==="gestor"||(t==null?void 0:t.role)==="admin",[s,d]=m.useState(new Date),[a,M]=m.useState(new Date),l=B({mutationFn:I,onMutate:()=>_("Preparando exportação..."),onSuccess:(o,F,i)=>{C(i),A(o.message||"Exportação concluída com sucesso!"),console.log("Dados exportados (Preview):",o.data_preview)},onError:(o,F,i)=>{C(i),b(`Falha na exportação: ${o.message}`)}}),P=()=>{if(!s||!a){b("Selecione o período de início e fim.");return}l.mutate({start_date:n(s,"yyyy-MM-dd"),end_date:n(a,"yyyy-MM-dd")})};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Relatórios e BI"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Análise de dados e ferramentas de exportação."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(u,{className:"lg:col-span-2",children:[e.jsx(h,{children:e.jsx(p,{className:"text-card-foreground",children:"Dashboard Analítico (BI)"})}),e.jsxs(j,{children:[e.jsx("p",{className:"text-muted-foreground text-left",children:"Aqui será integrado o dashboard de Business Intelligence com gráficos e métricas avançadas de produtividade e conformidade."}),e.jsx("div",{className:"h-64 bg-muted mt-4 flex items-center justify-center rounded-lg border border-dashed",children:e.jsx("span",{className:"text-muted-foreground",children:"Gráfico de Exemplo (Em Desenvolvimento)"})})]})]}),r&&e.jsxs(u,{className:"lg:col-span-1",children:[e.jsx(h,{children:e.jsxs(p,{className:"text-card-foreground flex items-center",children:[e.jsx(E,{className:"h-5 w-5 mr-2"})," Exportação Folha de Pagamento"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione o período para exportar os registros de ponto aprovados."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Período"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{children:[e.jsx(y,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:f("w-full justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),s?n(s,"dd/MM/yyyy"):e.jsx("span",{children:"Início"})]})}),e.jsx(w,{className:"w-auto p-0",children:e.jsx(v,{mode:"single",selected:s,onSelect:d,initialFocus:!0,locale:x})})]}),e.jsxs(N,{children:[e.jsx(y,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:f("w-full justify-start text-left font-normal",!a&&"text-muted-foreground"),children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),a?n(a,"dd/MM/yyyy"):e.jsx("span",{children:"Fim"})]})}),e.jsx(w,{className:"w-auto p-0",children:e.jsx(v,{mode:"single",selected:a,onSelect:M,initialFocus:!0,locale:x})})]})]})]}),e.jsx(c,{onClick:P,className:"w-full",disabled:l.isPending||!s||!a,children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Exportando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Exportar Dados"]})})]})]})]})]})};export{U as default};
