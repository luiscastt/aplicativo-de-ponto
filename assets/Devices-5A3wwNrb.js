import{r as j,m as e,ap as f,z as b}from"./vendor-CTLkAQ17.js";import{b as N,u as _,a as y}from"./vendor-supabase-query-BZ8e5l_3.js";import{C as w,a as C,b as T,d as D}from"./card-Cv3fZd4i.js";import{T as S,a as q,b as x,c as d,d as R,e as l}from"./table-DuTSpFz9.js";import{c as z,u as A,B,b as E,s as c}from"./index-BTnllf_j.js";import{s as L,a as $}from"./toast-BTgtjvQY.js";import{S as k,R as H,L as I,q as M,r as Q}from"./vendor-icons-BvmhBeEN.js";import"./vendor-react-router-xEMQRDFj.js";const F=b("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),h=j.forwardRef(({className:a,variant:i,size:t,...o},r)=>e.jsx(f,{ref:r,className:z(F({variant:i,size:t,className:a})),...o}));h.displayName=f.displayName;const G=async a=>{const{data:{user:i}}=await c.auth.getUser();let t=c.from("active_devices").select(`
      id, user_id, device_id, device_model, last_login, is_active,
      profiles(first_name, email)
    `).order("last_login",{ascending:!1});!a&&i&&(t=t.eq("user_id",i.id));const{data:o,error:r}=await t;if(r)throw r;return o},K=async(a,i)=>{const{error:t}=await c.from("active_devices").update({is_active:i,last_login:new Date().toISOString()}).eq("id",a);if(t)throw t},Z=()=>{const{user:a}=A(),i=N(),t=(a==null?void 0:a.role)==="gestor"||(a==null?void 0:a.role)==="admin",{data:o,isLoading:r,refetch:g}=_({queryKey:["devices",t],queryFn:()=>G(t),enabled:!!a}),m=y({mutationFn:({id:s,isActive:n})=>K(s,n),onSuccess:(s,n)=>{$(`Dispositivo ${n.isActive?"ativado":"desativado"} com sucesso.`),i.invalidateQueries({queryKey:["devices"]})},onError:s=>L(`Erro ao atualizar dispositivo: ${s.message}`)}),p=s=>{m.mutate({id:s.id,isActive:!s.is_active})},v=()=>r?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-primary"})}):!o||o.length===0?e.jsx("div",{className:"text-left text-muted-foreground py-8",children:"Nenhum dispositivo ativo encontrado."}):e.jsxs(S,{children:[e.jsx(q,{children:e.jsxs(x,{children:[t&&e.jsx(d,{children:"Colaborador"}),e.jsx(d,{children:"Modelo"}),e.jsx(d,{className:"hidden sm:table-cell",children:"ID Único"}),e.jsx(d,{children:"Último Login"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Ação"})]})}),e.jsx(R,{children:o.map(s=>{var n,u;return e.jsxs(x,{children:[t&&e.jsx(l,{className:"font-medium text-card-foreground",children:((n=s.profiles)==null?void 0:n.first_name)||((u=s.profiles)==null?void 0:u.email)}),e.jsx(l,{className:"text-card-foreground text-sm",children:s.device_model||"Desconhecido"}),e.jsx(l,{className:"hidden sm:table-cell text-xs text-muted-foreground max-w-[150px] truncate",children:s.device_id}),e.jsx(l,{className:"text-muted-foreground text-sm",children:new Date(s.last_login).toLocaleString("pt-BR")}),e.jsx(l,{children:e.jsx(E,{variant:s.is_active?"default":"destructive",children:s.is_active?"Ativo":"Inativo"})}),e.jsx(l,{children:e.jsx(h,{pressed:s.is_active,onPressedChange:()=>p(s),disabled:m.isPending,"aria-label":`Toggle ${s.device_model}`,children:s.is_active?e.jsx(M,{className:"h-4 w-4 text-green-600"}):e.jsx(Q,{className:"h-4 w-4 text-red-600"})})})]},s.id)})})]});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Controle de Dispositivos"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t?"Gerencie quais dispositivos estão autorizados a bater ponto.":"Seus dispositivos ativos."})]}),e.jsx("div",{className:"mb-6 flex justify-end",children:e.jsx(B,{variant:"outline",size:"icon",onClick:()=>g(),disabled:r,children:e.jsx(H,{className:`h-4 w-4 ${r?"animate-spin":""}`})})}),e.jsxs(w,{children:[e.jsx(C,{children:e.jsx(T,{className:"text-card-foreground",children:"Dispositivos Registrados"})}),e.jsx(D,{children:v()})]})]})};export{Z as default};
