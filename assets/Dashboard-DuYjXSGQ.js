import{m as e}from"./vendor-CTLkAQ17.js";import{u as C}from"./vendor-supabase-query-BZ8e5l_3.js";import{c as U,u as R,B as T,b as u,s as p}from"./index-BTnllf_j.js";import{C as f,a as _,b as A,d as N}from"./card-Cv3fZd4i.js";import{T as F,a as L,b as g,c as o,d as k,e as c}from"./table-DuTSpFz9.js";import{L as b,C as B,R as $}from"./vendor-icons-BvmhBeEN.js";import"./vendor-react-router-xEMQRDFj.js";function H({className:t,...l}){return e.jsx("div",{className:U("animate-pulse rounded-md bg-muted",t),...l})}const S=async()=>{const{data:t,error:l}=await p.from("points").select(`
      id, type, timestamp, location, photo_url, status,
      profiles(first_name, last_name, email)
    `).order("timestamp",{ascending:!1}).limit(10);if(l)throw l;return(t==null?void 0:t.map(a=>{var r,n,h;return{id:a.id,user:`${((r=a.profiles)==null?void 0:r.first_name)||""} ${((n=a.profiles)==null?void 0:n.last_name)||""}`.trim()||((h=a.profiles)==null?void 0:h.email)||"Desconhecido",type:a.type,timestamp:a.timestamp,location:a.location,photoUrl:a.photo_url,status:a.status}}))||[]},y=t=>{switch(t){case"aprovado":return"default";case"rejeitado":return"destructive";default:return"secondary"}},K=()=>{var j;const{user:t,isAuthenticated:l,profileLoading:a}=R(),{data:r,isLoading:n,refetch:h}=C({queryKey:["recentRecords"],queryFn:S,enabled:l&&!a});if(a)return e.jsx("div",{className:"flex justify-center items-center h-full min-h-[50vh]",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-primary"})});const v=(t==null?void 0:t.first_name)||((j=t==null?void 0:t.email)==null?void 0:j.split("@")[0])||"Gestor",w=()=>n?e.jsxs("div",{className:"py-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(b,{className:"h-6 w-6 animate-spin text-primary"})}),e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,i)=>e.jsx(H,{className:"h-10 w-full"},i))})]}):!r||r.length===0?e.jsx("div",{className:"text-left text-muted-foreground py-8",children:"Nenhum registro recente encontrado."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(F,{children:[e.jsx(L,{children:e.jsxs(g,{children:[e.jsx(o,{children:"Colaborador"}),e.jsx(o,{children:"Tipo"}),e.jsx(o,{children:"Horário"}),e.jsx(o,{children:"Localização"}),e.jsx(o,{children:"Foto"}),e.jsx(o,{children:"Status"})]})}),e.jsx(k,{children:r.map(s=>{var i,d,m,x;return e.jsxs(g,{children:[e.jsx(c,{className:"font-medium text-card-foreground",children:s.user}),e.jsx(c,{children:e.jsx(u,{variant:s.type==="entrada"?"default":"secondary",children:s.type})}),e.jsx(c,{className:"text-card-foreground",children:new Date(s.timestamp).toLocaleString("pt-BR")}),e.jsx(c,{className:"font-mono text-xs text-card-foreground",children:`${((d=(i=s.location)==null?void 0:i.latitude)==null?void 0:d.toFixed(4))||"N/A"}, ${((x=(m=s.location)==null?void 0:m.longitude)==null?void 0:x.toFixed(4))||"N/A"}`}),e.jsx(c,{children:s.photoUrl?e.jsx("a",{href:p.storage.from("point-photos").getPublicUrl(s.photoUrl).data.publicUrl,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:p.storage.from("point-photos").getPublicUrl(s.photoUrl).data.publicUrl,alt:"Foto",className:"w-8 h-8 rounded object-cover hover:opacity-75 transition-opacity"})}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"N/A"})}),e.jsx(c,{children:e.jsx(u,{variant:y(s.status),children:s.status})})]},s.id)})})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:r.map(s=>{var i,d,m,x;return e.jsx(f,{className:"shadow-sm",children:e.jsxs(N,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-semibold text-base truncate text-card-foreground",children:s.user}),e.jsx(u,{variant:y(s.status),className:"ml-2 flex-shrink-0",children:s.status})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Tipo: ",e.jsx(u,{variant:s.type==="entrada"?"default":"secondary",children:s.type})]}),e.jsxs("p",{children:["Horário: ",new Date(s.timestamp).toLocaleString("pt-BR")]}),e.jsxs("p",{className:"truncate",children:["Local: ",`${((d=(i=s.location)==null?void 0:i.latitude)==null?void 0:d.toFixed(4))||"N/A"}, ${((x=(m=s.location)==null?void 0:m.longitude)==null?void 0:x.toFixed(4))||"N/A"}`]})]}),s.photoUrl&&e.jsx("div",{className:"pt-2",children:e.jsx("a",{href:p.storage.from("point-photos").getPublicUrl(s.photoUrl).data.publicUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline text-sm",children:"Ver Foto"})})]})},s.id)})})]});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"h-6 w-6 text-primary"}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:["Bem-vindo, ",v]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Monitore registros recentes dos colaboradores."})]}),e.jsxs(f,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-xl text-card-foreground",children:"Registros Recentes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Últimos 10 pontos registrados"})]}),e.jsxs(T,{onClick:()=>h(),variant:"outline",size:"sm",disabled:n,children:[e.jsx($,{className:`mr-2 h-4 w-4 ${n?"animate-spin":""}`}),"Atualizar"]})]}),e.jsx(N,{children:w()})]})]})};export{K as default};
