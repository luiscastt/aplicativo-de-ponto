import{r as c,m as e,a0 as y,a1 as w,a2 as C,a3 as S}from"./vendor-CTLkAQ17.js";import{c as k,u as L,a as R,s as j,B as T}from"./index-BTnllf_j.js";import{C as m,a as x,b as f,c as u,d as h}from"./card-Cv3fZd4i.js";import{I as N}from"./input-BjE4wIy-.js";import{L as n}from"./label-DoZpU7nD.js";import{L as v,c as E,i as D}from"./vendor-icons-BvmhBeEN.js";import"./vendor-react-router-xEMQRDFj.js";import"./vendor-supabase-query-BZ8e5l_3.js";const i=c.forwardRef(({className:o,...r},s)=>e.jsxs(y,{ref:s,className:k("relative flex w-full touch-none select-none items-center",o),...r,children:[e.jsx(w,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(C,{className:"absolute h-full bg-primary"})}),e.jsx(S,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));i.displayName=y.displayName;const P=()=>{const{user:o}=L(),{toast:r}=R(),[s,l]=c.useState(null),[p,g]=c.useState(!1);c.useEffect(()=>{b()},[]);const b=async()=>{const{data:a,error:t}=await j.from("company_settings").select("*").eq("id","default").single();t&&t.code!=="PGRST116"&&r({variant:"destructive",title:"Erro ao carregar configurações",description:t.message}),l(a??{geofence_center:{lat:-23.5505,lng:-46.6333},geofence_radius:100,tolerance_minutes:15,photo_retention_days:30,updated_at:new Date().toISOString()})},_=async()=>{if(!s||!o)return;g(!0);const{error:a}=await j.from("company_settings").upsert({id:"default",...s,updated_at:new Date().toISOString()});r(a?{variant:"destructive",title:"Erro ao salvar configurações",description:a.message}:{title:"Configurações salvas!",description:"As alterações foram aplicadas."}),g(!1)},d=(a,t)=>{s&&l({...s,[a]:t[0]})};return s?e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(E,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Configurações da Empresa"})]})}),e.jsxs("div",{className:"max-w-2xl space-y-6",children:[e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(f,{className:"text-card-foreground text-left",children:"Geofence"}),e.jsx(u,{className:"text-left",children:"Definir área permitida para registro de pontos"})]}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-left block",children:"Centro da Área (Latitude, Longitude)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(N,{type:"number",step:"any",value:(s==null?void 0:s.geofence_center.lat)??"",onChange:a=>l(t=>t?{...t,geofence_center:{...t.geofence_center,lat:parseFloat(a.target.value)||0}}:null),placeholder:"Latitude"})}),e.jsx("div",{children:e.jsx(N,{type:"number",step:"any",value:(s==null?void 0:s.geofence_center.lng)??"",onChange:a=>l(t=>t?{...t,geofence_center:{...t.geofence_center,lng:parseFloat(a.target.value)||0}}:null),placeholder:"Longitude"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-left block",children:"Raio da Área (metros)"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("span",{className:"text-sm font-medium w-20 flex-shrink-0 text-card-foreground",children:[(s==null?void 0:s.geofence_radius)??100," m"]}),e.jsx(i,{value:[(s==null?void 0:s.geofence_radius)??100],onValueChange:a=>d("geofence_radius",a),min:50,max:500,step:10,className:"flex-1"})]})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(f,{className:"text-card-foreground text-left",children:"Tolerâncias"}),e.jsx(u,{className:"text-left",children:"Configurações de tempo e validação"})]}),e.jsx(h,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-left block",children:"Tolerância para Horário (minutos)"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("span",{className:"text-sm font-medium w-20 flex-shrink-0 text-card-foreground",children:[(s==null?void 0:s.tolerance_minutes)??15," min"]}),e.jsx(i,{value:[(s==null?void 0:s.tolerance_minutes)??15],onValueChange:a=>d("tolerance_minutes",a),min:5,max:60,step:5,className:"flex-1"})]})]})})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(f,{className:"text-card-foreground text-left",children:"Armazenamento de Fotos"}),e.jsx(u,{className:"text-left",children:"Período de retenção das imagens"})]}),e.jsx(h,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-left block",children:"Dias de Retenção"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("span",{className:"text-sm font-medium w-20 flex-shrink-0 text-card-foreground",children:[(s==null?void 0:s.photo_retention_days)??30," dias"]}),e.jsx(i,{value:[(s==null?void 0:s.photo_retention_days)??30],onValueChange:a=>d("photo_retention_days",a),min:7,max:90,step:7,className:"flex-1"})]})]})})]}),e.jsx(T,{onClick:_,className:"w-full",disabled:p||!s,children:p?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Salvar Configurações"]})})]})]}):e.jsx("div",{className:"flex items-center justify-center p-4 h-full min-h-[50vh]",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-primary"})})};export{P as default};
